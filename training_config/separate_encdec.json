local language_pairs = "DE-EN";

{
//  "vocabulary": {
//    "directory_path": "fixtures/vocab/vocabulary",
//    "extend": false
//  },
  "vocabulary": {
    "max_vocab_size": {
      "source_tokens": 14000,
      "target_tokens": 14000
    }
  },
  "dataset_reader": {
    "type": "two_way",
    "lazy": false
  },
  "language_pairs": language_pairs,
  "train_data_paths": "../data/iwslt14.tokenized.de-en/train.de-en",
  "validation_data_paths": "../data/iwslt14.tokenized.de-en/valid.de-en",
  "model": {
    "type": "separate_encdec",
    "language_pairs": language_pairs,
    "label_smoothing": 0.1,
    "identity_loss": false,

    "bleu_metric": true,
    "loss_metric": true,

    "architecture": "transformer_iwslt_de_en",
    "overrides": {
      "max_source_positions": 1024,
      "encoder_embed_dim": 512,
      "encoder_ffn_embed_dim": 1024,
      "encoder_attention_heads": 4,
      "encoder_layers": 6,
      "encoder_normalize_before": false,

      "max_target_positions": 1024,
      "decoder_embed_dim": 512,
      "decoder_ffn_embed_dim": 1024,
      "decoder_attention_heads": 4,
      "decoder_layers": 6,
      "decoder_normalize_before": false,

      "share_decoder_input_output_embed": false,
      "share_all_embeddings": false,
      "dropout": 0.3
    }
  },
  "iterator": {
    "type": "multi",
    "num_datasets": std.length(std.split(language_pairs, ' ')),
    "iterator_base": {
      "type": "bucket",
      "batch_size": 64,
      "sorting_keys": [
        [
          "sentence_a",
          "num_tokens"
        ]
      ],
      "biggest_batch_first": true
    }
  },
  "trainer": {
    "cuda_device": 0,
    "num_epochs": 100,
    "patience": 10,
    "num_serialized_models_to_keep": 5,
    "shuffle": false,
    "optimizer": {
      "type": "adam",
      "lr": 0.0001,
      "betas": [0.9, 0.98]
    }
  }
}
